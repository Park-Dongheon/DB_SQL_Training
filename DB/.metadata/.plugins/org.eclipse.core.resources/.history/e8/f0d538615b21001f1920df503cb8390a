package edu.pnu;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Scanner;

class Member {
	private int id;
	private String pass;
	private String name;
	
	public Member(int id, String pass, String name) {
		this.id = id;
		this.pass = pass;
		this.name = name;
	}
	
	public int getId() {
		return this.id;
	}
	
	public String getPass() {
		return this.pass;
	}

	public String getName() {
		return this.name;
	}
	
}

public class InsertSQL {
	private static String driver = "com.mysql.cj.jdbc.Driver";
	
	private static ResultSet selectMember(Connection con) throws SQLException {
	    String selectSql = "SELECT * FROM member";
	    PreparedStatement selPs = con.prepareStatement(selectSql);
	    return selPs.executeQuery();
	}
	
	private static int insertMember(Connection con, Scanner sc) throws SQLException {
		System.out.println("Insert Data");
		System.out.println("pass:");	String pass = sc.next();
		System.out.println("name:");	String name = sc.next();
		try(PreparedStatement psmt = con.prepareStatement("INSERT INTO member(pass, name) VALUES(?, ?)")) {
			psmt.setString(1, pass);
			psmt.setString(2, name);
			return psmt.executeUpdate();
		}
	}
	
	private static int updateMember(Connection con, Scanner sc) throws SQLException {
		System.out.println("Insert Data");
		System.out.print("id:");		int id = sc.nextInt();
		System.out.println("pass:");	String pass = sc.next();
		System.out.println("name:");	String name = sc.next();
		try(PreparedStatement psmt = con.prepareStatement("INSERT INTO member(pass, name) VALUES(?, ?)")) {
			psmt.setString(1, pass);
			psmt.setString(2, name);
			return psmt.executeUpdate();
		}
	}
	
    private static int deleteMember(Connection con, Scanner sc) throws SQLException {
        Statement st = con.createStatement();
        int ret = st.executeUpdate("DELETE FROM member");
        st.close();
        System.out.println("deletd: " + ret);
        return ret;
    }
    

	public static void main(String[] args) {
		Member member = new Member();

		Connection con = null;
		PreparedStatement ps = null;
		PreparedStatement selPs = null;
		ResultSet rs = null;
		int count = 0;
		try {
			
			Class.forName(driver);
			con = DriverManager.getConnection("jdbc:mysql://localhost:3306/musthave", "scott", "tiger");
			
//			deleteMember(con);
			
//			String sql = "INSERT INTO member(id, pass, name) VALUES(?, ?, ?)";
			String sql = "UPDATE member SET pass=?, name=? WHERE id=?;";
			
			
			ps = con.prepareStatement(sql);
//			for(int i = 1; i <= 10; i++) {
//				member.setId(i);
//				member.setPass("pass" + i);
//				member.setName("name" + i);
//				
////                count += insertMember(i, ps, member);
//                
//			}
			
			try(Scanner sc = new Scanner(System.in)) {
				boolean flag = true;
				while(flag) {
					System.out.println("[I]nsert/[U]pdate/[D]elete");
					String s = sc.next();
					switch(s) {
					case "i": case"I"
					case "u": case"U"
					case "d": case"D"
					}
				}
			}
			while(!sc.hasNextInt() || !sc.hasNext()) {
				sc.nextLine();
			}
			int inputId = sc.nextInt();
			String inputPass = sc.next();
			String inputName = sc.next();
			
			for(int i = 0; i < 3; i++) {
				updateMember(ps, inputId, inputPass,inputName);				
			}
			
	        rs = selectMember(con);

	        while (rs.next()) {
	            System.out.print(rs.getInt("id") + ", ");
	            System.out.print(rs.getString("pass") + ", ");
	            System.out.print(rs.getString("name") + "\n");
	        }

			
		}catch (Exception e) {
			System.out.println("연결 실패 : " + e.getMessage());
		}finally {
			try {
				if (rs != null) rs.close();
				if (ps != null) ps.close();
				if (con != null) con.close();
			} catch (SQLException e) {
				System.out.println("리소스 해제 실패 : " + e.getMessage());
			}
		}
	}

}
